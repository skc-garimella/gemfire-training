<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_79) on Wed Aug 19 14:59:48 PDT 2015 -->
<title>SystemFailure (GemFire Java API Documentation)</title>
<meta name="date" content="2015-08-19">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="SystemFailure (GemFire Java API Documentation)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/SystemFailure.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-files/index-1.html">Index</a></li>
</ul>
<div class="aboutLanguage"><em><i>GemFire 8.2.0</i></em></div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../com/gemstone/gemfire/SystemConnectException.html" title="class in com.gemstone.gemfire"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../com/gemstone/gemfire/SystemIsRunningException.html" title="class in com.gemstone.gemfire"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/gemstone/gemfire/SystemFailure.html" target="_top">Frames</a></li>
<li><a href="SystemFailure.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.gemstone.gemfire</div>
<h2 title="Class SystemFailure" class="title">Class SystemFailure</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>com.gemstone.gemfire.SystemFailure</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public final class <span class="strong">SystemFailure</span>
extends <a href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></pre>
<div class="block">Catches and responds to JVM failure
 <p>
 This class represents a catastrophic failure of the system,
 especially the Java virtual machine.  Any class may,
 at any time, indicate that a system failure has occurred by calling
 <a href="../../../com/gemstone/gemfire/SystemFailure.html#initiateFailure(java.lang.Error)"><code>initiateFailure(Error)</code></a> (or, less commonly,
 <a href="../../../com/gemstone/gemfire/SystemFailure.html#setFailure(java.lang.Error)"><code>setFailure(Error)</code></a>).
 <p>
 In practice, the most common type of failure that is likely to be
 reported by an otherwise healthy JVM is <a href="http://java.sun.com/javase/6/docs/api/java/lang/OutOfMemoryError.html?is-external=true" title="class or interface in java.lang"><code>OutOfMemoryError</code></a>.  However,
 GemFire will report any occurrence of <a href="http://java.sun.com/javase/6/docs/api/java/lang/VirtualMachineError.html?is-external=true" title="class or interface in java.lang"><code>VirtualMachineError</code></a> as
 a JVM failure.
 <p>
 When a failure is reported, you must assume that the JVM has <em>broken 
 its fundamental execution contract</em> with your application. 
 No programming invariant can be assumed to be true, and your 
 entire application must be regarded as corrupted.
 <h1>Failure Hooks</h1>
 GemFire uses this class to disable its distributed system (group
 communication) and any open caches.  It also provides a hook for you
 to respond to after GemFire disables itself.
 <h1>Failure WatchDog</h1>
 When <a href="../../../com/gemstone/gemfire/SystemFailure.html#startThreads()"><code>startThreads()</code></a> is called, a "watchdog" <a href="http://java.sun.com/javase/6/docs/api/java/lang/Thread.html?is-external=true" title="class or interface in java.lang"><code>Thread</code></a> is started that 
 periodically checks to see if system corruption has been reported.  When 
 system corruption is detected, this thread proceeds to:
 <p>
 <ol>
 <li>
 <em>Close GemFire</em> -- Group communication is ceased (this cache
 member recuses itself from the distributed system) and the cache
 is further poisoned (it is pointless to try to cleanly close it at this
 point.).
 <p>
 After this has successfully ended, we launch a
 </li>
 <li>
 <em>failure action</em>, a user-defined Runnable
 <a href="../../../com/gemstone/gemfire/SystemFailure.html#setFailureAction(java.lang.Runnable)"><code>setFailureAction(Runnable)</code></a>.
 By default, this Runnable performs nothing.  If you feel you need to perform
 an action before exiting the JVM, this hook gives you a
 means of attempting some action.  Whatever you attempt should be extremely
 simple, since your Java execution environment has been corrupted.
 <p>
 GemStone recommends that you employ 
 <a href="http://wrapper.tanukisoftware.org/doc/english/introduction.html">
 Java Service Wrapper</a> to detect when your JVM exits and to perform
 appropriate failure and restart actions.
 </li>
 <li>
 Finally, if the application has granted the watchdog permission to exit the JVM
 (via <a href="../../../com/gemstone/gemfire/SystemFailure.html#setExitOK(boolean)"><code>setExitOK(boolean)</code></a>), the watchdog calls <a href="http://java.sun.com/javase/6/docs/api/java/lang/System.html?is-external=true#exit(int)" title="class or interface in java.lang"><code>System.exit(int)</code></a> with
 an argument of 1.  If you have not granted this class permission to
 close the JVM, you are <em>strongly</em>  advised to call it in your
 failure action (in the previous step).
 </li>
 </ol>
 <p> 
 Each of these actions will be run exactly once in the above described
 order.  However, if either step throws any type of error (<a href="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang"><code>Throwable</code></a>), 
 the watchdog will assume that the JVM is still under duress (esp. an 
 <a href="http://java.sun.com/javase/6/docs/api/java/lang/OutOfMemoryError.html?is-external=true" title="class or interface in java.lang"><code>OutOfMemoryError</code></a>), will wait a bit, and then retry the failed action.
 <p>
 It bears repeating that you should be very cautious of any Runnables you
 ask this class to run.  By definition the JVM is <em>very sick</em>
 when failure has been signalled.  
 <p>
 <h1>Failure Proctor</h1>
 In addition to the failure watchdog, <a href="../../../com/gemstone/gemfire/SystemFailure.html#startThreads()"><code>startThreads()</code></a> creates a second
 thread (the "proctor") that monitors free memory. It does this by examining
 <a href="http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html?is-external=true#freeMemory()" title="class or interface in java.lang"><code>free memory</code></a>,  
 <a href="http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html?is-external=true#totalMemory()" title="class or interface in java.lang"><code>total memory</code></a> and 
 <a href="http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html?is-external=true#maxMemory()" title="class or interface in java.lang"><code>maximum memory</code></a>.  If the amount of available 
 memory stays below a given 
 <a href="../../../com/gemstone/gemfire/SystemFailure.html#setFailureMemoryThreshold(long)"><code>threshold</code></a>, for
 more than <a href="../../../com/gemstone/gemfire/SystemFailure.html#WATCHDOG_WAIT"><code>WATCHDOG_WAIT</code></a> seconds, the watchdog is notified.
 <p>
 Note that the proctor can be effectively disabled by
 <a href="../../../com/gemstone/gemfire/SystemFailure.html#setFailureMemoryThreshold(long)"><code>setting</code></a> the failure memory threshold
 to a negative value.
 <p>
 The proctor is a second line of defense, attempting to detect 
 OutOfMemoryError conditions in circumstances where nothing alerted the
 watchdog.  For instance, a third-party jar might incorrectly handle this
 error and leave your virtual machine in a "stuck" state.
 <p>
 Note that the proctor does not relieve you of the obligation to
 follow the best practices in the next section.
 <h1>Best Practices</h1>
 <h2>Catch and Handle VirtualMachineError</h2>
 If you feel obliged to catch <em>either</em> <a href="http://java.sun.com/javase/6/docs/api/java/lang/Error.html?is-external=true" title="class or interface in java.lang"><code>Error</code></a>, or 
 <a href="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang"><code>Throwable</code></a>, you <em>must</em>also check for 
 <a href="http://java.sun.com/javase/6/docs/api/java/lang/VirtualMachineError.html?is-external=true" title="class or interface in java.lang"><code>VirtualMachineError</code></a> like so:
 <p>
 <pre>
        catch (VirtualMachineError err) {
          SystemFailure.<a href="../../../com/gemstone/gemfire/SystemFailure.html#initiateFailure(java.lang.Error)"><code>initiateFailure</code></a>(err);
          // If this ever returns, rethrow the error.  We're poisoned
          // now, so don't let this thread continue.
          throw err;
        }
 </pre>
 <h2>Periodically Check For Errors</h2>
 Check for serious system errors at
 appropriate points in your algorithms.  You may elect to use
 the <a href="../../../com/gemstone/gemfire/SystemFailure.html#checkFailure()"><code>checkFailure()</code></a> utility function, but you are
 not required to (you could just see if <a href="../../../com/gemstone/gemfire/SystemFailure.html#getFailure()"><code>getFailure()</code></a>
 returns a non-null result).  
 <p>
 A job processing loop is a good candidate, for
 instance, in com.gemstone.org.jgroups.protocols.UDP#run(), 
 which implements <a href="http://java.sun.com/javase/6/docs/api/java/lang/Thread.html?is-external=true#run()" title="class or interface in java.lang"><code>Thread.run()</code></a>:
 <p>
 <pre>
         for (;;)  {
           SystemFailure.<a href="../../../com/gemstone/gemfire/SystemFailure.html#checkFailure()"><code>checkFailure</code></a>();
           if (mcast_recv_sock == null || mcast_recv_sock.isClosed()) break;
           if (Thread.currentThread().isInterrupted()) break;
          ...
 </pre>
 <h2>Create Logging ThreadGroups</h2>
 If you create any Thread, a best practice is to catch severe errors
 and signal failure appropriately.  One trick to do this is to create a 
 ThreadGroup that handles uncaught exceptions by overriding 
 <a href="http://java.sun.com/javase/6/docs/api/java/lang/ThreadGroup.html?is-external=true#uncaughtException(java.lang.Thread,%20java.lang.Throwable)" title="class or interface in java.lang"><code>ThreadGroup.uncaughtException(Thread, Throwable)</code></a> and to declare 
 your thread as a member of that <a href="http://java.sun.com/javase/6/docs/api/java/lang/ThreadGroup.html?is-external=true" title="class or interface in java.lang"><code>ThreadGroup</code></a>.  This also has a 
 significant side-benefit in that most uncaught exceptions 
 can be detected:
 <p>
 <pre>
    ThreadGroup tg = new ThreadGroup("Worker Threads") {
        public void uncaughtException(Thread t, Throwable e) {
          // Do this *before* any object allocation in case of
          // OutOfMemoryError (for instance)
          if (e instanceof VirtualMachineError) {
            SystemFailure.<a href="../../../com/gemstone/gemfire/SystemFailure.html#setFailure(java.lang.Error)"><code>setFailure</code></a>((VirtualMachineError)e); // don't throw
          }
          String s = "Uncaught exception in thread " + t;
          system.getLogWriter().severe(s, e);
        }
        Thread t = new Thread(myRunnable, tg, "My Thread");
        t.start();
      }; * </pre>
 <p>
 <h2>Catches of Error and Throwable Should Check for Failure</h2>
 Keep in mind that peculiar or flat-out<em>impossible</em>  exceptions may 
 ensue after a VirtualMachineError has been thrown <em>anywhere</em> in
 your virtual machine. Whenever you catch <a href="http://java.sun.com/javase/6/docs/api/java/lang/Error.html?is-external=true" title="class or interface in java.lang"><code>Error</code></a> or <a href="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang"><code>Throwable</code></a>, 
 you should also make sure that you aren't dealing with a corrupted JVM:
 <p>
 <pre>
        catch (Throwable t) {
          // Whenever you catch Error or Throwable, you must also
          // catch VirtualMachineError (see above).  However, there is
          // _still_ a possibility that you are dealing with a cascading
          // error condition, so you also need to check to see if the JVM
          // is still usable:
          SystemFailure.<a href="../../../com/gemstone/gemfire/SystemFailure.html#checkFailure()"><code>checkFailure</code></a>();
          ...
        }
 </pre></div>
<dl><dt><span class="strong">Since:</span></dt>
  <dd>5.1</dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static <a href="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#DISTRIBUTED_SYSTEM_DISCONNECTED_MESSAGE">DISTRIBUTED_SYSTEM_DISCONNECTED_MESSAGE</a></strong></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static <a href="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#DISTRIBUTION_HALTED_MESSAGE">DISTRIBUTION_HALTED_MESSAGE</a></strong></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static long</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#MEMORY_MAX_WAIT">MEMORY_MAX_WAIT</a></strong></code>
<div class="block">This is the maximum amount of time, in seconds, that the proctor thread
 will tolerate seeing free memory stay below
 <a href="../../../com/gemstone/gemfire/SystemFailure.html#setFailureMemoryThreshold(long)"><code>setFailureMemoryThreshold(long)</code></a>, after which point it will 
 declare a system failure.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static long</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#MEMORY_POLL_INTERVAL">MEMORY_POLL_INTERVAL</a></strong></code>
<div class="block">This is the interval, in seconds, that the proctor
 thread will awaken and poll system free memory.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static boolean</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#MONITOR_MEMORY">MONITOR_MEMORY</a></strong></code>
<div class="block">Flag that determines whether or not we monitor memory on our own.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static boolean</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#TRACE_CLOSE">TRACE_CLOSE</a></strong></code>
<div class="block">If true, we track the progress of emergencyClose
 on System.err</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#WATCHDOG_WAIT">WATCHDOG_WAIT</a></strong></code>
<div class="block">This is the amount of time, in seconds, the watchdog periodically awakens
 to see if the system has been corrupted.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#checkFailure()">checkFailure</a></strong>()</code>
<div class="block">Utility function to check for failures.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#emergencyClose()">emergencyClose</a></strong>()</code>
<div class="block">Attempt to close any and all GemFire resources.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static <a href="http://java.sun.com/javase/6/docs/api/java/lang/Error.html?is-external=true" title="class or interface in java.lang">Error</a></code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#getFailure()">getFailure</a></strong>()</code>
<div class="block">Returns the catastrophic system failure, if any.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#initiateFailure(java.lang.Error)">initiateFailure</a></strong>(<a href="http://java.sun.com/javase/6/docs/api/java/lang/Error.html?is-external=true" title="class or interface in java.lang">Error</a>&nbsp;f)</code>
<div class="block">Signals that a system failure has occurred and then throws an
 AssertionError.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static boolean</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#isJVMFailureError(java.lang.Error)">isJVMFailureError</a></strong>(<a href="http://java.sun.com/javase/6/docs/api/java/lang/Error.html?is-external=true" title="class or interface in java.lang">Error</a>&nbsp;err)</code>
<div class="block">Returns true if the given Error is a fatal to the JVM and it should be shut
 down.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#loadEmergencyClasses()">loadEmergencyClasses</a></strong>()</code>
<div class="block">Since it requires object memory to unpack a jar file,
 make sure this JVM has loaded the classes necessary for
 closure <em>before</em> it becomes necessary to use them.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static boolean</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#setExitOK(boolean)">setExitOK</a></strong>(boolean&nbsp;newVal)</code>
<div class="block">Indicate whether it is acceptable to call <a href="http://java.sun.com/javase/6/docs/api/java/lang/System.html?is-external=true#exit(int)" title="class or interface in java.lang"><code>System.exit(int)</code></a> after
 failure processing has completed.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#setFailure(java.lang.Error)">setFailure</a></strong>(<a href="http://java.sun.com/javase/6/docs/api/java/lang/Error.html?is-external=true" title="class or interface in java.lang">Error</a>&nbsp;failure)</code>
<div class="block">Set the underlying system failure, if not already set.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static <a href="http://java.sun.com/javase/6/docs/api/java/lang/Runnable.html?is-external=true" title="class or interface in java.lang">Runnable</a></code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#setFailureAction(java.lang.Runnable)">setFailureAction</a></strong>(<a href="http://java.sun.com/javase/6/docs/api/java/lang/Runnable.html?is-external=true" title="class or interface in java.lang">Runnable</a>&nbsp;action)</code>
<div class="block">Sets a user-defined action that is run in the event
 that failure has been detected.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static long</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#setFailureMemoryThreshold(long)">setFailureMemoryThreshold</a></strong>(long&nbsp;newVal)</code>
<div class="block">Set the memory threshold under which system failure will be
 notified.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#signalCacheClose()">signalCacheClose</a></strong>()</code>
<div class="block">Should be invoked when GemFire cache is closing or closed.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#signalCacheCreate()">signalCacheCreate</a></strong>()</code>
<div class="block">Should be invoked when GemFire cache is being created.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#startThreads()">startThreads</a></strong>()</code>
<div class="block">This starts up the watchdog and proctor threads.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><strong><a href="../../../com/gemstone/gemfire/SystemFailure.html#stopThreads()">stopThreads</a></strong>()</code>
<div class="block">This stops the threads that implement this service.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang">equals</a>, <a href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang">getClass</a>, <a href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang">hashCode</a>, <a href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang">notify</a>, <a href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang">notifyAll</a>, <a href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#toString()" title="class or interface in java.lang">toString</a>, <a href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang">wait</a>, <a href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang">wait</a>, <a href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long,%20int)" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="DISTRIBUTION_HALTED_MESSAGE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>DISTRIBUTION_HALTED_MESSAGE</h4>
<pre>public static final&nbsp;<a href="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> DISTRIBUTION_HALTED_MESSAGE</pre>
</li>
</ul>
<a name="DISTRIBUTED_SYSTEM_DISCONNECTED_MESSAGE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>DISTRIBUTED_SYSTEM_DISCONNECTED_MESSAGE</h4>
<pre>public static final&nbsp;<a href="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> DISTRIBUTED_SYSTEM_DISCONNECTED_MESSAGE</pre>
</li>
</ul>
<a name="WATCHDOG_WAIT">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>WATCHDOG_WAIT</h4>
<pre>public static final&nbsp;int WATCHDOG_WAIT</pre>
<div class="block">This is the amount of time, in seconds, the watchdog periodically awakens
 to see if the system has been corrupted.
 <p>
 The watchdog will be explicitly awakened by calls to
 <a href="../../../com/gemstone/gemfire/SystemFailure.html#setFailure(java.lang.Error)"><code>setFailure(Error)</code></a> or <a href="../../../com/gemstone/gemfire/SystemFailure.html#initiateFailure(java.lang.Error)"><code>initiateFailure(Error)</code></a>, but
 it will awaken of its own accord periodically to check for failure even
 if the above calls do not occur.
 <p>
 This can be set with the system property 
 <code>gemfire.WATCHDOG_WAIT</code>. The default is 15 sec.</div>
</li>
</ul>
<a name="MEMORY_POLL_INTERVAL">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>MEMORY_POLL_INTERVAL</h4>
<pre>public static final&nbsp;long MEMORY_POLL_INTERVAL</pre>
<div class="block">This is the interval, in seconds, that the proctor
 thread will awaken and poll system free memory.
 
 The default is 1 sec.  This can be set using the system property
 <code>gemfire.SystemFailure.MEMORY_POLL_INTERVAL</code>.</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../com/gemstone/gemfire/SystemFailure.html#setFailureMemoryThreshold(long)"><code>setFailureMemoryThreshold(long)</code></a></dd></dl>
</li>
</ul>
<a name="MEMORY_MAX_WAIT">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>MEMORY_MAX_WAIT</h4>
<pre>public static final&nbsp;long MEMORY_MAX_WAIT</pre>
<div class="block">This is the maximum amount of time, in seconds, that the proctor thread
 will tolerate seeing free memory stay below
 <a href="../../../com/gemstone/gemfire/SystemFailure.html#setFailureMemoryThreshold(long)"><code>setFailureMemoryThreshold(long)</code></a>, after which point it will 
 declare a system failure.
 
 The default is 15 sec.  This can be set using the system property
 <code>gemfire.SystemFailure.MEMORY_MAX_WAIT</code>.</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../com/gemstone/gemfire/SystemFailure.html#setFailureMemoryThreshold(long)"><code>setFailureMemoryThreshold(long)</code></a></dd></dl>
</li>
</ul>
<a name="MONITOR_MEMORY">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>MONITOR_MEMORY</h4>
<pre>public static final&nbsp;boolean MONITOR_MEMORY</pre>
<div class="block">Flag that determines whether or not we monitor memory on our own.
 If this flag is set, we will check freeMemory, invoke GC if free memory 
 gets low, and start throwing our own OutOfMemoryException if 
 
 The default is false, so this monitoring is turned off. This monitoring has been found 
 to be unreliable in non-Sun VMs when the VM is under stress or behaves in unpredictable ways.</div>
<dl><dt><span class="strong">Since:</span></dt>
  <dd>6.5</dd></dl>
</li>
</ul>
<a name="TRACE_CLOSE">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>TRACE_CLOSE</h4>
<pre>public static final&nbsp;boolean TRACE_CLOSE</pre>
<div class="block">If true, we track the progress of emergencyClose
 on System.err</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../constant-values.html#com.gemstone.gemfire.SystemFailure.TRACE_CLOSE">Constant Field Values</a></dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="setExitOK(boolean)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setExitOK</h4>
<pre>public static&nbsp;boolean&nbsp;setExitOK(boolean&nbsp;newVal)</pre>
<div class="block">Indicate whether it is acceptable to call <a href="http://java.sun.com/javase/6/docs/api/java/lang/System.html?is-external=true#exit(int)" title="class or interface in java.lang"><code>System.exit(int)</code></a> after
 failure processing has completed.
 <p>
 This may be dynamically modified while the system is running.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>newVal</code> - true if it is OK to exit the process</dd>
<dt><span class="strong">Returns:</span></dt><dd>the previous value</dd></dl>
</li>
</ul>
<a name="isJVMFailureError(java.lang.Error)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isJVMFailureError</h4>
<pre>public static&nbsp;boolean&nbsp;isJVMFailureError(<a href="http://java.sun.com/javase/6/docs/api/java/lang/Error.html?is-external=true" title="class or interface in java.lang">Error</a>&nbsp;err)</pre>
<div class="block">Returns true if the given Error is a fatal to the JVM and it should be shut
 down. Code should call <a href="../../../com/gemstone/gemfire/SystemFailure.html#initiateFailure(java.lang.Error)"><code>initiateFailure(Error)</code></a> or
 <a href="../../../com/gemstone/gemfire/SystemFailure.html#setFailure(java.lang.Error)"><code>setFailure(Error)</code></a> if this returns true.</div>
</li>
</ul>
<a name="signalCacheCreate()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>signalCacheCreate</h4>
<pre>public static&nbsp;void&nbsp;signalCacheCreate()</pre>
<div class="block">Should be invoked when GemFire cache is being created.</div>
</li>
</ul>
<a name="signalCacheClose()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>signalCacheClose</h4>
<pre>public static&nbsp;void&nbsp;signalCacheClose()</pre>
<div class="block">Should be invoked when GemFire cache is closing or closed.</div>
</li>
</ul>
<a name="loadEmergencyClasses()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>loadEmergencyClasses</h4>
<pre>public static&nbsp;void&nbsp;loadEmergencyClasses()</pre>
<div class="block">Since it requires object memory to unpack a jar file,
 make sure this JVM has loaded the classes necessary for
 closure <em>before</em> it becomes necessary to use them.
 <p>
 Note that just touching the class in order to load it
 is usually sufficient, so all an implementation needs
 to do is to reference the same classes used in
 <a href="../../../com/gemstone/gemfire/SystemFailure.html#emergencyClose()"><code>emergencyClose()</code></a>.  Just make sure to do it while
 you still have memory to succeed!</div>
</li>
</ul>
<a name="emergencyClose()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>emergencyClose</h4>
<pre>public static&nbsp;void&nbsp;emergencyClose()</pre>
<div class="block">Attempt to close any and all GemFire resources.
 
 The contract of this method is that it should not
 acquire any synchronization mutexes nor create any objects.
 <p>
 The former is because the system is in an undefined state and
 attempting to acquire the mutex may cause a hang.
 <p>
 The latter is because the likelihood is that we are invoking
 this method due to memory exhaustion, so any attempt to create
 an object will also cause a hang.
 <p>
 This method is not meant to be called directly (but, well, I
 guess it could).  It is public to document the contract
 that is implemented by <code>emergencyClose</code> in other
 parts of the system.</div>
</li>
</ul>
<a name="checkFailure()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkFailure</h4>
<pre>public static&nbsp;void&nbsp;checkFailure()
                         throws <a href="../../../com/gemstone/gemfire/InternalGemFireError.html" title="class in com.gemstone.gemfire">InternalGemFireError</a>,
                                <a href="http://java.sun.com/javase/6/docs/api/java/lang/Error.html?is-external=true" title="class or interface in java.lang">Error</a></pre>
<div class="block">Utility function to check for failures.  If a failure is
 detected, this methods throws an AssertionFailure.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../com/gemstone/gemfire/InternalGemFireError.html" title="class in com.gemstone.gemfire">InternalGemFireError</a></code> - if the system has been corrupted</dd>
<dd><code><a href="http://java.sun.com/javase/6/docs/api/java/lang/Error.html?is-external=true" title="class or interface in java.lang">Error</a></code> - if the system has been corrupted and a thread-specific 
 AssertionError cannot be allocated</dd><dt><span class="strong">See Also:</span></dt><dd><a href="../../../com/gemstone/gemfire/SystemFailure.html#initiateFailure(java.lang.Error)"><code>initiateFailure(Error)</code></a></dd></dl>
</li>
</ul>
<a name="initiateFailure(java.lang.Error)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>initiateFailure</h4>
<pre>public static&nbsp;void&nbsp;initiateFailure(<a href="http://java.sun.com/javase/6/docs/api/java/lang/Error.html?is-external=true" title="class or interface in java.lang">Error</a>&nbsp;f)
                            throws <a href="../../../com/gemstone/gemfire/InternalGemFireError.html" title="class in com.gemstone.gemfire">InternalGemFireError</a>,
                                   <a href="http://java.sun.com/javase/6/docs/api/java/lang/Error.html?is-external=true" title="class or interface in java.lang">Error</a></pre>
<div class="block">Signals that a system failure has occurred and then throws an
 AssertionError.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>f</code> - the failure to set</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://java.sun.com/javase/6/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</a></code> - if f is null</dd>
<dd><code><a href="../../../com/gemstone/gemfire/InternalGemFireError.html" title="class in com.gemstone.gemfire">InternalGemFireError</a></code> - always; this method does not return normally.</dd>
<dd><code><a href="http://java.sun.com/javase/6/docs/api/java/lang/Error.html?is-external=true" title="class or interface in java.lang">Error</a></code> - if a thread-specific AssertionError cannot be allocated.</dd></dl>
</li>
</ul>
<a name="setFailure(java.lang.Error)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setFailure</h4>
<pre>public static&nbsp;void&nbsp;setFailure(<a href="http://java.sun.com/javase/6/docs/api/java/lang/Error.html?is-external=true" title="class or interface in java.lang">Error</a>&nbsp;failure)</pre>
<div class="block">Set the underlying system failure, if not already set.
 <p>
 This method does not generate an error, and should only be used
 in circumstances where execution needs to continue, such as when
 re-implementing <a href="http://java.sun.com/javase/6/docs/api/java/lang/ThreadGroup.html?is-external=true#uncaughtException(java.lang.Thread,%20java.lang.Throwable)" title="class or interface in java.lang"><code>ThreadGroup.uncaughtException(Thread, Throwable)</code></a>.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>failure</code> - the system failure</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://java.sun.com/javase/6/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</a></code> - if you attempt to set the failure to null</dd></dl>
</li>
</ul>
<a name="getFailure()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getFailure</h4>
<pre>public static&nbsp;<a href="http://java.sun.com/javase/6/docs/api/java/lang/Error.html?is-external=true" title="class or interface in java.lang">Error</a>&nbsp;getFailure()</pre>
<div class="block">Returns the catastrophic system failure, if any.
 <p>
 This is usually (though not necessarily) an instance of
 <a href="http://java.sun.com/javase/6/docs/api/java/lang/VirtualMachineError.html?is-external=true" title="class or interface in java.lang"><code>VirtualMachineError</code></a>.
 <p>
 A return value of null indicates that no system failure has yet been
 detected.
 <p>
 Object synchronization can implicitly require object creation (fat locks 
 in JRockit for instance), so the underlying value is not synchronized
 (it is a volatile). This means the return value from this call is not 
 necessarily the <em>first</em> failure reported by the JVM.
 <p>
 Note that even if it <em>were</em> synchronized, it would only be a 
 proximal indicator near the time that the JVM crashed, and may not 
 actually reflect the underlying root cause that generated the failure.  
 For instance, if your JVM is running short of memory, this Throwable is 
 probably an innocent victim and <em>not</em> the actual allocation (or 
 series of allocations) that caused your JVM to exhaust memory.
 <p>
 If this function returns a non-null value, keep in mind that the JVM is
 very limited.  In particular, any attempt to allocate objects may fail
 if the original failure was an OutOfMemoryError.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>the failure, if any</dd></dl>
</li>
</ul>
<a name="setFailureAction(java.lang.Runnable)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setFailureAction</h4>
<pre>public static&nbsp;<a href="http://java.sun.com/javase/6/docs/api/java/lang/Runnable.html?is-external=true" title="class or interface in java.lang">Runnable</a>&nbsp;setFailureAction(<a href="http://java.sun.com/javase/6/docs/api/java/lang/Runnable.html?is-external=true" title="class or interface in java.lang">Runnable</a>&nbsp;action)</pre>
<div class="block">Sets a user-defined action that is run in the event
 that failure has been detected.
 <p> 
 This action is run <em>after</em> the GemFire cache has been shut down.
 If it throws any error, it will be reattempted indefinitely until it
 succeeds. This action may be dynamically modified while the system
 is running.
 <p>
 The default action prints the failure stack trace to System.err.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>action</code> - the Runnable to use</dd>
<dt><span class="strong">Returns:</span></dt><dd>the previous action</dd><dt><span class="strong">See Also:</span></dt><dd><a href="../../../com/gemstone/gemfire/SystemFailure.html#initiateFailure(java.lang.Error)"><code>initiateFailure(Error)</code></a></dd></dl>
</li>
</ul>
<a name="setFailureMemoryThreshold(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setFailureMemoryThreshold</h4>
<pre>public static&nbsp;long&nbsp;setFailureMemoryThreshold(long&nbsp;newVal)</pre>
<div class="block">Set the memory threshold under which system failure will be
 notified. 
 
 This value may be dynamically  modified while the system
 is running.  The default is 1048576 bytes.  This can be set using the 
 system property <code>gemfire.SystemFailure.chronic_memory_threshold</code>.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>newVal</code> - threshold in bytes</dd>
<dt><span class="strong">Returns:</span></dt><dd>the old threshold</dd><dt><span class="strong">See Also:</span></dt><dd><a href="http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html?is-external=true#freeMemory()" title="class or interface in java.lang"><code>Runtime.freeMemory()</code></a></dd></dl>
</li>
</ul>
<a name="startThreads()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>startThreads</h4>
<pre>public static&nbsp;void&nbsp;startThreads()</pre>
<div class="block">This starts up the watchdog and proctor threads.
 This method is called when a Cache is created.</div>
</li>
</ul>
<a name="stopThreads()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>stopThreads</h4>
<pre>public static&nbsp;void&nbsp;stopThreads()</pre>
<div class="block">This stops the threads that implement this service.
 This method is called when a Cache is closed.</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/SystemFailure.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-files/index-1.html">Index</a></li>
</ul>
<div class="aboutLanguage"><em><i>GemFire 8.2.0</i></em></div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../com/gemstone/gemfire/SystemConnectException.html" title="class in com.gemstone.gemfire"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../com/gemstone/gemfire/SystemIsRunningException.html" title="class in com.gemstone.gemfire"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/gemstone/gemfire/SystemFailure.html" target="_top">Frames</a></li>
<li><a href="SystemFailure.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small><i>Copyright &copy; 1997-2015 Pivotal Software, Inc. All rights reserved.</i></small></p>
</body>
</html>
